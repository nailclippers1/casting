<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>投票結果ランキング</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    h1 { text-align: center; }
    .character { margin: 20px 0; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
    ol { padding-left: 20px; }
  </style>
</head>
<body>
  <h1>投票結果ランキング</h1>
  <label>作品を選択: 
    <select id="workSelector"></select>
  </label>

  <div id="results"></div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/【あなたのGASデプロイURL】/exec";

    async function loadResults() {
      const res = await fetch(scriptURL);
      const data = await res.json();

      const workSelector = document.getElementById("workSelector");
      workSelector.innerHTML = "";

      Object.keys(data).forEach(work => {
        const opt = document.createElement("option");
        opt.value = work;
        opt.textContent = work;
        workSelector.appendChild(opt);
      });

      workSelector.addEventListener("change", () => renderResults(data, workSelector.value));

      // 初期表示
      if (Object.keys(data).length > 0) {
        renderResults(data, Object.keys(data)[0]);
      }
    }

    function renderResults(data, work) {
      const container = document.getElementById("results");
      container.innerHTML = "";

      const characters = data[work];
      for (const char in characters) {
        const charDiv = document.createElement("div");
        charDiv.className = "character";

        const title = document.createElement("h2");
        title.textContent = char;
        charDiv.appendChild(title);

        const ranking = Object.entries(characters[char])
          .sort((a, b) => b[1] - a[1]); // 票数でソート

        const ol = document.createElement("ol");
        ranking.forEach(([actor, votes]) => {
          const li = document.createElement("li");
          li.textContent = `${actor} — ${votes}票`;
          ol.appendChild(li);
        });

        charDiv.appendChild(ol);
        container.appendChild(charDiv);
      }
    }

    loadResults();
  </script>
</body>
</html>
